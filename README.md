# PS Calendar to ICS (ZJU)

将浙江大学 PeopleSoft 课程表导出为 ICS 文件的 Tampermonkey 用户脚本。

## 功能特点

### 🎯 核心功能
- ✅ **浙大PeopleSoft专用** - 专为浙江大学课程系统设计
- ✅ **智能课程识别** - 基于真实HTML结构精确解析课程信息
- ✅ **课程代码+组件命名** - 自动生成"CS 101 [实验室] (LA1)"格式的清晰标识
- ✅ **多组件支持** - 正确处理实验室、讲授、习题课等不同组件

### 📅 行事历功能
- ✅ **2025-2026学年行事历** - 内置完整的学校行事历数据
- ✅ **假期自动跳过** - 中秋国庆、元旦等假期自动排除课程
- ✅ **调休日处理** - 9月28日补10月3日、10月11日补10月8日等调休安排
- ✅ **停课日识别** - 校运动会等停课期间自动处理
- ✅ **特殊事件** - 自动添加开学典礼、学生节等重要日期

### 🔧 技术特性
- ✅ **精确日期生成** - 每个上课日期都经过行事历验证，无多余或缺失
- ✅ **状态继承逻辑** - 智能处理连续行中课程代码和组件的状态管理
- ✅ **时区支持** - 使用 Asia/Shanghai 时区确保时间准确
- ✅ **离线测试** - 支持本地HTML文件测试和调试

## 安装使用

### 1. 安装 Tampermonkey

在浏览器中安装 [Tampermonkey](https://www.tampermonkey.net/) 扩展。

### 2. 安装脚本

1. 打开 Tampermonkey 管理面板
2. 点击"创建新脚本"
3. 复制 `scripts/ps-calendar-to-ics.user.js` 的全部内容
4. 粘贴并保存

### 3. 使用方法

1. 登录浙江大学 PeopleSoft 系统
2. 进入【选课】→【我的每周课程表】
3. 确保选择【列表查看】视图（非日历视图）
4. 页面右下角会出现"导出 ICS"按钮
5. 点击按钮即可下载 `ZJU-<学期标题>.ics` 文件
6. 将下载的 ICS 文件导入到 Google Calendar、Outlook 等日历应用

## 离线测试

脚本支持本地 HTML 文件测试：

1. 在 PeopleSoft 课表页面保存完整网页（Ctrl+S）
2. 用浏览器打开保存的 HTML 文件
3. "导出 ICS"按钮同样可见并可正常工作

## 支持的数据格式

### 时间格式
- `星期一 2:00PM - 3:50PM`
- `周二 08:00 - 09:35`
- `一三五 13:00-14:35`

### 日期格式
- `15/09/2025 - 21/09/2025` (DD/MM/YYYY)
- `09/15/2025 - 09/21/2025` (MM/DD/YYYY)
- `2025-09-15 - 2025-09-21` (YYYY-MM-DD)

### 课程表结构
脚本会自动识别包含以下列的表格：
- 日期和时间
- 教室/地点
- 讲师/教师
- 开始/结束日期

## 故障排除

### 按钮不出现
- 确认处于"列表查看"模式，而非"每周日历"模式
- 确认页面包含课程表数据
- 刷新页面重试

### 导出的课程为空
- 检查是否有"TBA"或"待定"的课程时间
- 确认日期格式被正确识别
- 查看浏览器控制台是否有错误信息

### 课程名称显示不正确
- 脚本会自动查找 `td.PAGROUPDIVIDER` 中的课程名称
- 如果找不到，会显示为"课程 1"、"课程 2"等
- 可以在导入日历后手动修改事件标题

### 时区问题
- 脚本使用 Asia/Shanghai 时区
- 如需其他时区，可修改脚本中的 `TZID` 常量

## 技术细点

- **时区**: Asia/Shanghai (UTC+8, 无夏令时)
- **日期生成**: 精确计算每个上课日期，自动排除假期
- **行事历**: 内置2024-2025学年秋冬学期完整行事历
- **补课处理**: 自动识别并标注补课日期
- **UID 生成**: 基于课程信息和日期的唯一哈希值
- **文件编码**: UTF-8
- **兼容性**: 支持所有主流日历应用

## 行事历支持 📅

### 2024-2025学年秋冬学期
- **学期时间**: 9月15日 - 12月26日
- **假期自动排除**:
  - 10月1-8日：中秋节、国庆节
  - 10月24-26日：秋季校运动会
  - 12月29-30日：复习与考试
  - 1月1日：元旦
  - 1月2-10日：复习与考试
- **补课自动处理**:
  - 9月28日：补10月3日（周五）课程
  - 10月11日：补10月8日（周三）课程

## 许可证

MIT License

